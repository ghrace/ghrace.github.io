<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>性能优化 | 个人网站</title>
    <meta name="description" content="郭洪荣的前端学习记录 不仅仅是前端">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.b82fca8b.css" as="style"><link rel="preload" href="/assets/js/app.5aeb107c.js" as="script"><link rel="preload" href="/assets/js/2.4fdc1c58.js" as="script"><link rel="preload" href="/assets/js/39.913c2199.js" as="script"><link rel="prefetch" href="/assets/js/10.868d25f6.js"><link rel="prefetch" href="/assets/js/11.26af7a99.js"><link rel="prefetch" href="/assets/js/12.762f8752.js"><link rel="prefetch" href="/assets/js/13.854eb825.js"><link rel="prefetch" href="/assets/js/14.6822de39.js"><link rel="prefetch" href="/assets/js/15.bc4ca6f6.js"><link rel="prefetch" href="/assets/js/16.6b6632e4.js"><link rel="prefetch" href="/assets/js/17.43ab99fb.js"><link rel="prefetch" href="/assets/js/18.faec3129.js"><link rel="prefetch" href="/assets/js/19.d16a7a15.js"><link rel="prefetch" href="/assets/js/20.7ea8da42.js"><link rel="prefetch" href="/assets/js/21.9b6d23ce.js"><link rel="prefetch" href="/assets/js/22.a942cbe6.js"><link rel="prefetch" href="/assets/js/23.eee51ce3.js"><link rel="prefetch" href="/assets/js/24.b737b7b6.js"><link rel="prefetch" href="/assets/js/25.7ed26cdd.js"><link rel="prefetch" href="/assets/js/26.ea1af7cf.js"><link rel="prefetch" href="/assets/js/27.0954bbd9.js"><link rel="prefetch" href="/assets/js/28.3e5ca140.js"><link rel="prefetch" href="/assets/js/29.0f3b21c3.js"><link rel="prefetch" href="/assets/js/3.fe866395.js"><link rel="prefetch" href="/assets/js/30.b3fd4cc2.js"><link rel="prefetch" href="/assets/js/31.51ff1f64.js"><link rel="prefetch" href="/assets/js/32.4951671b.js"><link rel="prefetch" href="/assets/js/33.c701a210.js"><link rel="prefetch" href="/assets/js/34.b067bbea.js"><link rel="prefetch" href="/assets/js/35.0f173c75.js"><link rel="prefetch" href="/assets/js/36.708964d0.js"><link rel="prefetch" href="/assets/js/37.56528064.js"><link rel="prefetch" href="/assets/js/38.bf30a6a3.js"><link rel="prefetch" href="/assets/js/4.16d71e6f.js"><link rel="prefetch" href="/assets/js/40.85fc73a6.js"><link rel="prefetch" href="/assets/js/41.9ef05bab.js"><link rel="prefetch" href="/assets/js/42.6babaf7a.js"><link rel="prefetch" href="/assets/js/43.263d78f3.js"><link rel="prefetch" href="/assets/js/44.e36347b1.js"><link rel="prefetch" href="/assets/js/45.d9b47675.js"><link rel="prefetch" href="/assets/js/46.99be333e.js"><link rel="prefetch" href="/assets/js/47.3bf90a36.js"><link rel="prefetch" href="/assets/js/5.509d29db.js"><link rel="prefetch" href="/assets/js/6.46861842.js"><link rel="prefetch" href="/assets/js/7.0949719a.js"><link rel="prefetch" href="/assets/js/8.78018ce0.js"><link rel="prefetch" href="/assets/js/9.d72fdb24.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b82fca8b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">个人网站</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about.html" class="nav-link">关于</a></div><div class="nav-item"><a href="https://github.com/ghrace" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about.html" class="nav-link">关于</a></div><div class="nav-item"><a href="https://github.com/ghrace" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JS</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/posts/2018-08-08-js-issue.html" class="sidebar-link">js总结</a></li><li><a href="/posts/2018-08-10-frontend-interview.html" class="sidebar-link">常见面试问题</a></li><li><a href="/posts/2018-08-09-copy-paste.html" class="sidebar-link">复制、剪切、粘贴事件</a></li><li><a href="/posts/2018-09-12-interview-question.html" class="sidebar-link">面试常见问题</a></li><li><a href="/posts/2019-03-04-js-repeat.html" class="sidebar-link">JS去重总结</a></li><li><a href="/posts/2019-03-04-interviews.html" class="sidebar-link">最近面试问题</a></li><li><a href="/posts/2018-10-29-performance-optimization.html" class="active sidebar-link">性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/posts/2018-10-29-performance-optimization.html#性能优化" class="sidebar-link">性能优化</a></li><li class="sidebar-sub-header"><a href="/posts/2018-10-29-performance-optimization.html#提前解析dns" class="sidebar-link">提前解析DNS</a></li><li class="sidebar-sub-header"><a href="/posts/2018-10-29-performance-optimization.html#script阻塞" class="sidebar-link">script阻塞</a></li><li class="sidebar-sub-header"><a href="/posts/2018-10-29-performance-optimization.html#js执行" class="sidebar-link">js执行</a></li><li class="sidebar-sub-header"><a href="/posts/2018-10-29-performance-optimization.html#浏览器" class="sidebar-link">浏览器</a></li><li class="sidebar-sub-header"><a href="/posts/2018-10-29-performance-optimization.html#webpack优化" class="sidebar-link">webpack优化</a></li><li class="sidebar-sub-header"><a href="/posts/2018-10-29-performance-optimization.html#vue项目优化" class="sidebar-link">vue项目优化</a></li><li class="sidebar-sub-header"><a href="/posts/2018-10-29-performance-optimization.html#youtube优化" class="sidebar-link">youtube优化</a></li></ul></li><li><a href="/posts/2019-09-05-js-test.html" class="sidebar-link">JS questions</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES6</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Others</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="性能优化"><a href="#性能优化" aria-hidden="true" class="header-anchor">#</a> 性能优化</h2> <p>浏览器打开网页的过程</p> <ol><li>浏览器对URL进行DNS解析</li> <li>浏览器与服务器进行TCP连接</li> <li>浏览器发出HTTP请求</li> <li>服务器返回HTTP响应</li> <li>浏览器进行页面渲染</li></ol> <p>前端的资源加载优化两个方向:</p> <ol><li>开源 增加域名,cdn,可以第三方,可以二级域名</li> <li>节流 资源压缩、按需加载,文件多了,就按需加载,延时加载</li></ol> <h2 id="提前解析dns"><a href="#提前解析dns" aria-hidden="true" class="header-anchor">#</a> 提前解析DNS</h2> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- DNS prefetch技术 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dns-prefetch<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>x-dns-prefetch-control<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>on/off<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

</code></pre></div><p>其中 图片处理</p> <ul><li>css实现(按钮,阴影)</li> <li>压缩尺寸 大小</li> <li>spirte</li> <li>svg toff</li> <li>canvas绘制大图(map)</li></ul> <h2 id="script阻塞"><a href="#script阻塞" aria-hidden="true" class="header-anchor">#</a> script阻塞</h2> <p>script放到最后,或者用 defer和async</p> <ul><li>有 <code>async</code> 加载和渲染后续文档元素的过程将和脚本的加载与执行并行进行（异步）,html4.0中定义了defer</li> <li>有 <code>defer</code>，加载后续文档元素的过程将和脚本加载并行进行（异步），但是脚本的执行要在所有元素解析完成之后，DOMContentLoaded 事件触发之前完成,html5.0中定义了async</li> <li>async 则是乱序执行，反正对它来说脚本的加载和执行是紧紧挨着的，所以不管你声明的顺序如何，只要它加载完了就会立刻执行,对于那些可以不依赖任何脚本或不被任何脚本依赖的脚本来说却是非常合适的，最典型的例子：<code>Google Analytics</code></li></ul> <h2 id="js执行"><a href="#js执行" aria-hidden="true" class="header-anchor">#</a> js执行</h2> <ol><li>作用域层级不要太深,或者嵌套多</li> <li>循环优化</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//缓存length,不用每次计算 测试原生for循环速度是最快的,比forEach map</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> list<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//do something</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>数组和对象，避免使用构造函数Array(),Object()</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// bad </span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obejct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
o<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;jack&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// good</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token punctuation">{</span>
    name <span class="token punctuation">:</span> <span class="token string">&quot;jack&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ol start="4"><li>DOM编程
尽可能少的重绘repaint和重排reflow,<br>
当页面的布局发生变化，影响到现有的文档流需要重新调整页面排版的时候,比如:</li></ol> <ul><li>添加或删除可见的DOM元素</li> <li>DOM元素位置改变</li> <li>DOM元素尺寸改变：容器padding、border、margin属性变化等</li> <li>容器内的内容变化导致宽高变化：文本行数变多（少）、图片坍塌、图片被另一张大图替换</li> <li>浏览器窗口初始化和尺寸改变 重排结束后，就需要重绘。所以，尽可能的避免重排的产生，为了避免或少的进行重绘和重排，需要尽可能少的访问某些变量:</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>offsetTop、offsetLeft、offsetWidth、offsetHeight
scrollTop、scrollLeft、scrollWidth、scrollHeight
clientTop、clientLeft、clientWidth、clientHeight
</code></pre></div><p>总结:少访问DOM，在js里处理计算完了再一次性修改，善用缓存和原生API</p> <h2 id="浏览器"><a href="#浏览器" aria-hidden="true" class="header-anchor">#</a> 浏览器</h2> <ul><li>DNS查询,减少DNS查询次数</li> <li>tcp/http 主要核心
<ol><li>消除和减少不必要的网络延迟</li> <li>把传输字节数降到最少
具体</li></ol> <ul><li>减少HTTP请求：对于HTTP1.0/1.1 减少请求资源数（打包、压缩、合并等）</li> <li>使用CDN</li> <li>添加Expires首部并配置ETag标签</li> <li>gZip压缩js.css 不要压图片</li> <li>避免HTTP重定向</li> <li>持久化连接：避免TCP的三次握手，HTTP1.1默认开启，HTTP1.0可以使用：<code>Connection: Keep-Alive</code></li> <li>消除不必要的请求字节</li> <li>嵌入资源，如：Base64嵌入资源（针对小的静态图片资源）</li></ul></li></ul> <h2 id="webpack优化"><a href="#webpack优化" aria-hidden="true" class="header-anchor">#</a> webpack优化</h2> <ol><li><strong>压缩图片</strong></li></ol> <p>可以用 <code>image-webpack-loader</code> 来压缩图片</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token punctuation">:</span> <span class="token regex">/\.(png|jpe?g|gif|svg)(\?.*)?$/</span><span class="token punctuation">,</span>
  use<span class="token punctuation">:</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
    loader<span class="token punctuation">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
    options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      limit<span class="token punctuation">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> utils<span class="token punctuation">.</span><span class="token function">assetsPath</span><span class="token punctuation">(</span><span class="token string">'img/[name].[hash:7].[ext]'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      loader<span class="token punctuation">:</span> <span class="token string">'image-webpack-loader'</span><span class="token punctuation">,</span>
      options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        bypassOnDebug<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li><strong>减少 ES6 转为 ES5 的冗余代码</strong></li></ol> <p>Babel 插件会在将 ES6 代码转换成 ES5 代码时会注入一些辅助函数,多个源代码文件都依赖这些辅助函数，那么这些辅助函数的代码将会出现很多次，造成代码冗余</p> <p><code>babel-plugin-transform-runtime</code> 插件就是将相关辅助函数进行替换成导入语句，从而减小 babel 编译出来的代码的文件大小</p> <p>修改 .babelrc 配置文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;plugins&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;transform-runtime&quot;</span>
<span class="token punctuation">]</span>
</code></pre></div><ol start="3"><li><strong>提取公共代码</strong></li></ol> <p>将每个页面的第三方库和公共模块提取出来,抽离成单独的文件,用<code>CommonsChunkPlugin</code>插件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 所有在 package.json 里面依赖的包，都会被打包进 vendor.js 这个文件中。</span>
<span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'vendor'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">minChunks</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      module<span class="token punctuation">.</span>resource <span class="token operator">&amp;&amp;</span>
      <span class="token regex">/\.js$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>resource<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
      module<span class="token punctuation">.</span>resource<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>
        path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../node_modules'</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token comment">// 抽取出代码模块的映射关系</span>
<span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'manifest'</span><span class="token punctuation">,</span>
  chunks<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'vendor'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="4"><li><strong>模板预编译</strong></li></ol> <p>编译模板最简单的方式就是使用单文件组件——相关的构建设置会自动把预编译处理好，所以构建好的代码已经包含了编译出来的渲染函数而不是原始的模板字符串
可以使用 <code>vue-template-loader</code>，它也可以在构建过程中把模板文件转换成为 JavaScript 渲染函数</p> <p>DLLPlugin预编译,插件专门用于单独的webpack配置中，以创建dll的捆绑包。它创建一个manifest.json文件，DllReferencePlugin使用它来映射依赖项</p> <ol start="5"><li><strong>提取css</strong></li></ol> <p>所有组件的 CSS 提取到同一个文件可以避免这个问题，也会让 CSS 更好地进行压缩和缓存<br> <code>webpack + vue-loader</code> ( vue-cli 的 webpack 模板已经预先配置好)</p> <ol start="6"><li><strong>优化 SourceMap</strong></li></ol> <p>开发环境推荐： <code>cheap-module-eval-source-map</code></p> <p>生产环境推荐： <code>cheap-module-source-map</code>
7. <strong>多线程压缩</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// happypack</span>
<span class="token comment">//1. 安装依赖</span>
 npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev thread<span class="token operator">-</span><span class="token function">loader</span> <span class="token punctuation">(</span>之后方法省略该步骤<span class="token punctuation">)</span>
<span class="token comment">//2. module中引入</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
              <span class="token punctuation">{</span>
                  test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
                  include<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token comment">//多线程编译 项目不大不建议使用</span>
                  use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                      loader<span class="token punctuation">:</span> <span class="token string">'thread-loader'</span><span class="token punctuation">,</span>
                      options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                          workers<span class="token punctuation">:</span> <span class="token number">3</span>
                      <span class="token punctuation">}</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                 	<span class="token string">'babel-loader?cacheDirectory=true'</span><span class="token punctuation">]</span>

              <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</code></pre></div><ol start="8"><li><strong>多线程多实例压缩</strong></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//安装后添加到optimization中</span>
optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    minimizer<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">//开启并行压缩，true为默认值，可设数值， 同样项目小不建议使用，可能反而延长时间</span>
        parallel<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">//开启压缩缓存</span>
        cache<span class="token punctuation">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><ol start="9"><li><strong>开启缓存</strong></li></ol> <ul><li>开启babel-loaer缓存（直接在babel-loader后添加?cacheDirectory=true方法1中)</li> <li>开启terser-webpack-plugin缓存</li> <li>使用<code>hard-source-webpack-plugin</code>提升模块转换阶段缓存</li></ul> <div class="language- extra-class"><pre class="language-text"><code>plugins:[
		// ...
    new HardSourceWebpackPlugin(),
]
</code></pre></div><ol start="10"><li><strong>css treeShaking</strong> <code>purgecss-webpack-plugin</code> 进行treeshaking，删除未使用的css；</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">PATHS</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    src<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>
		<span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token comment">//必须和mini-css-extract-plugin配合使用</span>
    <span class="token keyword">new</span> <span class="token class-name">PurgecssPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    	paths<span class="token punctuation">:</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">PATHS</span><span class="token punctuation">.</span>src<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/**/*</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span> nodir<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
</code></pre></div><ol start="11"><li><strong>缩小构建目标</strong>
缩小构建目标，减少每次构建文件查找范围也能提高速度</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1. 排除或缩小目录</span>
    module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
              	<span class="token comment">//只在解析src下文件</span>
              	include<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              	<span class="token comment">//排除 node_module文件夹，通常不需要同时使用。</span>
								exclude<span class="token punctuation">:</span> <span class="token string">'node_module'</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
    	<span class="token punctuation">}</span>
<span class="token comment">//2.resolve模块使用</span>
  resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//合理使用别名,减少搜索层级</span>
    alias<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token comment">//import react可以直接找到</span>
      <span class="token string">&quot;react&quot;</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../node_module/react/dist/react.min.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
     modules<span class="token punctuation">:</span><span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&quot;../node_module&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
      <span class="token comment">//后缀名，如import 'index'时会自动按extensions顺序查找，可选多个，但查找速度慢，指定为一下数组中类型时，其他类必须写明后缀，否则无法找到</span>
     extensions<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">.</span>js<span class="token punctuation">]</span><span class="token punctuation">,</span>
     <span class="token comment">//packjson指定的入口文件</span>
     mainFeilds<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'main'</span><span class="token punctuation">]</span> 
  <span class="token punctuation">}</span>      
</code></pre></div><ol start="12"><li><strong>其他</strong></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>
  <span class="token comment">// 提示框</span>
  <span class="token keyword">new</span> <span class="token class-name">WebpackBuildNotifyerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  	<span class="token comment">//提示项目名</span>
    title<span class="token punctuation">:</span> <span class="token string">'project'</span><span class="token punctuation">,</span>
    suppressSuccess<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">//进度条</span>
  <span class="token keyword">new</span> <span class="token class-name">ProgressBarPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">//仪表盘，看需要</span>
  <span class="token comment">//new DashboardPlugin()，</span>
  <span class="token comment">//错误提示，需要同stats使用</span>
  <span class="token keyword">new</span> <span class="token class-name">FriendlyErrorsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token comment">// 体积分析，需要的时候加上，有多种分析插件</span>
  <span class="token comment">// new BundleAnalyzerPlugin(),</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="vue项目优化"><a href="#vue项目优化" aria-hidden="true" class="header-anchor">#</a> vue项目优化</h2> <ol><li><strong>长列表性能优化</strong></li></ol> <p>禁止 Vue 劫持我们的数据,可以通过 Object.freeze 方法来冻结一个对象，一旦被冻结的对象就再也不能被修改了</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">data</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    users<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">async</span> <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>users <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li><p>v-if 适用于在运行时很少改变条件，不需要频繁切换条件的场景；v-show 则适用于需要非常频繁切换条件的场景</p></li> <li><p>computed watch</p></li></ol> <ul><li><p>当我们需要进行数值计算，并且依赖于其它数据时，应该使用 computed，因为可以利用 computed 的缓存特性，避免每次获取值时，都要重新计算；</p></li> <li><p>当我们需要在数据变化时执行异步或开销较大的操作时，应该使用 watch，使用 watch 选项允许我们执行异步操作 ( 访问一个 API )，限制我们执行该操作的频率，并在我们得到最终结果前，设置中间状态。这些都是计算属性无法做到的。</p></li></ul> <ol start="4"><li><p>v-for 遍历避免同时使用 v-if
v-for 比 v-if 优先级高，如果每一次都需要遍历整个数组，将会影响速度，尤其是当之需要渲染很小一部分的时候，必要情况下应该替换成 computed 属性。</p></li> <li><p>图片资源懒加载 <code>vue-lazyload</code></p></li> <li><p>路由懒加载</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">Foo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./Foo.vue'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  routes<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">'/foo'</span><span class="token punctuation">,</span> component<span class="token punctuation">:</span> Foo <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="7"><li>第三方插件的按需引入
插件   <code>babel-plugin-component</code></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// .babelrc</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;presets&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;es2015&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">&quot;modules&quot;</span><span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;plugins&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;component&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">&quot;libraryName&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;element-ui&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;styleLibraryName&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;theme-chalk&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="youtube优化"><a href="#youtube优化" aria-hidden="true" class="header-anchor">#</a> youtube优化</h2> <ol><li><p>协议层面尽快升级到http/2+quic（http/3），会为我们带来15%性能提升，并且可以让挤地铁的同学有更好的视频播放体验</p></li> <li><p>压缩格式br，可以更有效的压缩html、js、css</p></li></ol> <p>Gzip 压缩算法简介:</p> <p>Gzip 基于 DEFLATE 算法，它是 LZ77 和霍夫曼编码的组合，最早用于 UNIX 系统的文件压缩。HTTP 协议上的 Gzip 编码是一种用来进 Web 应用程序性能的技术，Web 服务器和客户端（浏览器）必须共同支持 Gzip，当下主流的浏览器都是支持 Gzip 压缩，包括 IE6、IE7、IE8、IE9、FireFox、Google Chrome、Opera 等。</p> <p>Brotli 压缩算法简介:</p> <p>Google 在 2015 年 9 月推出了无损压缩算法 Brotli。Brotli 通过变种的 LZ77 算法、Huffman 编码以及二阶文本建模等方式进行数据压缩，与其他压缩算法相比，它有着更高的压缩效率。</p> <p>Brotli 压缩算法具有多个特点，最典型的是以下 3 个：</p> <ul><li>针对常见的 Web 资源内容，Brotli 的性能相比 Gzip 提高了 17-25%；</li> <li>当 Brotli 压缩级别为 1 时，压缩率比 Gzip 压缩等级为 9（最高）时还要高；</li> <li>在处理不同 HTML 文档时，Brotli 依然能够提供非常高的压缩率。</li></ul> <p>除了 IE 和 Opera Mini 之外，几乎所有的主流浏览器都已支持 Brotli 算法。</p> <div class="language- extra-class"><pre class="language-text"><code>Nginx 配置

#Brotli Compression
brotli on;
brotli_comp_level 6;
brotli_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript application/javascript image/svg+xml;
</code></pre></div><ol start="3"><li><p>对于多页面公用的css和js，你可以通过在http header中增加link perconnent，让文件内引用的其他域名获得加速，而不需要在html新增标签覆盖面更广</p></li> <li><p>合理使用 <code>requestIdleCallback</code> &amp; <code>cancelIdleCallback</code> 可以让你的代码执行减少拥堵</p></li> <li><p>如果你需要把一个多页面站点改造成单页应用又不想付出高昂的代价，可以尝试考虑spf.js的方案（需要服务端配合,劫持全局A链接的点击事件，只请求下一个页面渲染所需的数据在当前页面完成渲染，避免了大量无意义的http建联和模块重新渲染的开销，加快了页面渲染的速度。</p></li> <li><p>在首个请求体积可控的情况下内联必须的JS和CSS会让你获得更快的首屏时间（实验结果建议&lt;200k）</p></li> <li><p>采用svg实现icon，不仅体积小还可以实现动画，比base64和iconfont要更灵活。</p></li> <li><p>尽可能的重用页面资源和已渲染的模块，避免任何一点不必要的浪费</p></li> <li><p>视频格式 vp9和av1比国内常见的h.264有明显的优势，而且不像h.265要收取高额的费用</p></li> <li><p><code>Web Animations api</code>,允许同步和定时更改网页的呈现, 即DOM元素的动画。它通过组合两个模型来实现：时序模型 和 动画模型</p></li> <li><p><code>Web Components &amp; Polymer</code>,允许您创建可重用的定制元素（它们的功能封装在您的代码之外）并且在您的web应用中使用它们</p></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/posts/2019-03-04-interviews.html" class="prev">
          最近面试问题
        </a></span> <span class="next"><a href="/posts/2019-09-05-js-test.html">
          JS questions
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"><div class="cat-container" data-v-ebb16f12><canvas id="vuepress-cat" width="280" height="250" class="live2d" data-v-ebb16f12></canvas></div></div></div>
    <script src="/assets/js/app.5aeb107c.js" defer></script><script src="/assets/js/2.4fdc1c58.js" defer></script><script src="/assets/js/39.913c2199.js" defer></script>
  </body>
</html>
